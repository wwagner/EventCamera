# Event Camera Tracking Configuration
# ALL UNITS: meters (m) and degrees (deg) unless otherwise noted
# Edit this file to configure tracking parameters - changes take effect on next run
# The application loads from this file ONLY (no persistence/saving)

[Camera]
# Event camera bias settings (hardware-specific, unitless 0-255)
bias_diff = 128       # Event detection threshold (0-255)
bias_refr = 128       # Refractory period (0-255)
bias_fo = 128         # Photoreceptor follower (0-255)
bias_hpf = 128        # High-pass filter (0-255)
bias_pr = 128         # Pixel photoreceptor (0-255)
# Event accumulation period in seconds (range: 0.001-0.05)
accumulation_time_s = 0.01

[Stereo]
# Stereo camera geometry - all spatial units in meters, angles in degrees
# Baseline of 0.5m works well for objects at 0.5m distance
baseline_m = 0.75                # Camera separation (range: 0.1-2.0)
# Yaw angle set to 0 for parallel stereo (cameras facing same direction)
# This matches the synthetic camera positions at [-baseline/2, 0, 0] and [+baseline/2, 0, 0]
yaw_deg = 25.0                   # Camera yaw angle (range: 0-45)
pitch_deg = 0                   # Camera pitch angle (range: -30 to 30)
camera_elevation_m = 0          # Height above ground (range: -1.0 to 1.0)
# Field of view based on event camera optics
fov_horizontal_deg = 74.5       # Horizontal field of view (range: 30-120)
fov_vertical_deg = 43.5         # Vertical field of view (range: 20-90)

[View]
# 3D visualization view parameters
azimuth = 180                   # View azimuth angle in degrees (range: 0-360)
elevation = -35                 # View elevation angle in degrees (range: -90 to 90)
distance = 2.3                  # Camera distance from origin in meters (range: 0.5-10.0)

[LEDDetection]
# LED detection parameters
min_brightness = 5              # Minimum brightness threshold (range: 0-255)
# Area thresholds are in square meters (approximate conversion: ~1000px/m at typical resolution)
# Default values: min=0.000002m² (~2px), max=0.002m² (~2000px)
min_area_m2 = 0.000002          # Minimum LED area (range: 0.000001-0.0001)
max_area_m2 = 0.002             # Maximum LED area (range: 0.0001-0.01)

[StereoMatching]
# Stereo matching constraints in meters (accounts for non-rectified cameras with yaw)
# These are relaxed to handle convergent stereo (cameras angled inward)
# Approximate conversion at typical resolution: ~1000px/m
max_y_diff_m = 0.20             # Maximum vertical disparity (range: 0.01-0.5)
max_dist_m = 0.50               # Maximum matching distance (range: 0.05-1.0)

[Triangulation]
# Triangulation depth filtering in meters
# TEMPORARY: Very relaxed range to accommodate current scale mismatch workaround
min_depth_m = 0.001             # Minimum valid depth (range: 0.0001-1.0)
max_depth_m = 1.0               # Maximum valid depth (range: 0.1-100.0)
max_distance_m = 1.0            # Maximum distance from origin (range: 0.1-100.0)
# Minimum w threshold for homogeneous coordinate division (technical parameter)
min_w_threshold = 1e-8          # Minimum w value (range: 1e-10 to 1e-6)
# Radial bias correction for convergent stereo (corrects systematic bias toward/away from convergence point)
radial_bias_correction = 0.0    # Radial bias factor (range: -0.5 to 0.5)
                                 # Positive values push points away from center
                                 # Negative values pull points toward center
# Direct XYZ offset corrections (for systematic position biases)
x_offset_m = 0.0                 # X-axis offset in meters (range: -0.5 to 0.5)
y_offset_m = 0.0                 # Y-axis offset in meters (range: -0.5 to 0.5)
z_offset_m = 0.0                 # Z-axis (depth) offset in meters (range: -0.5 to 0.5)

[Tracking]
# Pose estimation and validation parameters
min_leds_for_tracking = 4       # Minimum LEDs needed for pose (range: 3-10)
# TEMPORARY: Scale correction factor to compensate for coordinate system mismatch
# TODO: Fix root cause in calibration/triangulation instead of using this workaround
# NOTE: Back to 8.8 after T vector unit scaling (multiplied by 100 for cm)
scale_correction_factor = 8.8   # Scale multiplier (range: 0.1-20.0)
# Pose validation thresholds (unitless ratios and confidence 0.0-1.0)
max_radius_error_ratio = 0.5    # Max radius error tolerance, 50% (range: 0.1-2.0)
min_confidence = 0.3            # Minimum tracking confidence, 30% (range: 0.0-1.0)
# Outlier rejection for triangulated points
outlier_distance_multiplier = 3.0  # Median distance multiplier (range: 2.0-5.0)
outlier_tolerance_m = 0.05      # Additional tolerance in meters (range: 0.0-0.2)

[ClusterTracking]
# Cluster-based tracking parameters (used when use_led_clusters=1)
# ============================================================================
# These parameters control how the tracking system recognizes and uses LED clusters
# ============================================================================
min_leds_per_cluster = 2        # Minimum LEDs to recognize cluster (range: 2-3)
                                # 2 = allows partial clusters (occlusion tolerant)
                                # 3 = requires complete clusters (more robust)
min_clusters_for_tracking = 2   # Minimum clusters needed for pose estimation (range: 2-4)
                                # 2 = minimum for 6-DOF pose (less redundancy)
                                # 3+ = more robust, better handles occlusion
max_cluster_match_distance_m = 0.025  # Maximum distance to match LEDs to cluster (25mm)
                                # Should be ~3× cluster_separation_m for robustness
                                # Range: 0.01-0.05m (10mm-50mm)
use_color_validation = 1        # Validate RGB pattern in clusters (0=no, 1=yes)
                                # 1 = requires R/G/B pattern matching (more robust)
                                # 0 = only uses geometry (faster, less reliable)
color_tolerance = 0.3           # Color matching tolerance (0.0-1.0)
                                # 0.0 = exact color match required (strict)
                                # 1.0 = very loose matching (permissive)
                                # 0.3 = moderate tolerance for lighting variation

[Window]
# Display window dimensions in pixels (unavoidable pixel units for UI)
# Width increased to 1920 to accommodate optimization panel
width = 1920                    # Window width in pixels
height = 840                    # Window height in pixels

[Simulation]
# Synthetic camera simulation viewer settings
window_width = 1920             # Simulation window width in pixels (0 = fullscreen)
window_height = 1080            # Simulation window height in pixels (0 = fullscreen)
fullscreen = 0                  # Start in fullscreen mode (0=no, 1=yes)
num_objects = 1                 # Number of tracked objects (range: 1-4)
# Sphere geometry in meters
# Sphere diameter of 10cm (0.1m) - realistic physical size for hardware tracking
sphere_diameter_m = 0.1        # Sphere diameter (range: 0.05-0.5)
# LED Cluster configuration (NEW: RGB cluster-based tracking)
# ============================================================================
# Cluster Mode: Organizes LEDs into identifiable RGB patterns for robust tracking
# - Each cluster = 4 LEDs: 1 red center + 3 green LEDs along dodecahedron edges
# - Clusters placed at vertices of platonic solids for symmetric distribution
# - Enables tracking with fewer visible markers (only need 2-3 clusters vs many single LEDs)
# - Color patterns allow unique cluster identification
# ============================================================================
use_led_clusters = 1            # Enable LED cluster mode (0=single LEDs, 1=RGB clusters)
cluster_count = 20              # Number of LED clusters on sphere (range: 4, 6, 8, 12, or 20)
                                # 4=Tetrahedron, 6=Cube, 8=Octahedron, 12=Icosahedron, 20=Dodecahedron
                                # 20 clusters = 80 total LEDs (20 × 4)
                                # Lower count = easier to track individual clusters
                                # Higher count = more redundancy, better coverage
leds_per_cluster = 4            # LEDs per cluster (4 = 1 red center + 3 green peripheral)
                                # Pattern: red center, 3 green LEDs along edges
cluster_separation_m = 0.005    # Distance from center LED to peripheral LEDs (5mm)
                                # Smaller = tighter cluster, harder to resolve individual LEDs
                                # Larger = easier to see individual LEDs, larger cluster footprint
                                # Range: 0.003-0.02m (3mm-20mm)
# Legacy LED configuration (used when use_led_clusters=0)
led_count = 48                  # Number of LEDs per sphere (range: 4-100)
# LED marker size
led_radius_m = 0.0005            # LED marker radius in meters (1mm, range: 0.0001-0.01)
# Distance of 0.5m matches the baseline for optimal depth accuracy
distance_from_screen_m = 0.6    # Distance from screen to sphere (range: 0.1-5.0)

[Debug]
# Debug verbosity levels: 0=silent, 1=errors, 2=warnings/info, 3=periodic, 4=verbose
# Set to 1 (errors only) by default to reduce logging overhead during optimization
verbosity = 1                      # Verbosity level (range: 0-4)
show_projection_matrices = 0       # Show projection matrices (0=no, 1=yes)
show_triangulation_details = 0     # Show triangulation details (0=no, 1=yes)
show_pose_estimation = 0           # Show pose estimation (0=no, 1=yes)
show_coordinate_transform = 0      # Show coordinate transformations (0=no, 1=yes)
